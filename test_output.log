WARNING: `anchor-lang` version(0.31.0) and the current CLI version(0.31.1) don't match.

	This can lead to unwanted behavior. To use the same CLI version, add:

	[toolchain]
	anchor_version = "0.31.0"

	to Anchor.toml

warning: use of deprecated method `anchor_lang::prelude::AccountInfo::<'a>::realloc`: Use AccountInfo::resize() instead
  --> programs/smartolana/src/lib.rs:20:1
   |
20 | #[program]
   | ^^^^^^^^^^
   |
   = note: `#[warn(deprecated)]` on by default
   = note: this warning originates in the attribute macro `program` (in Nightly builds, run with -Z macro-backtrace for more info)

warning: `smartolana` (lib) generated 1 warning
    Finished `release` profile [optimized] target(s) in 0.10s
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.09s
     Running unittests src/lib.rs (/Users/kartiktomar/rustie/validator_anchor_demo/target/debug/deps/smartolana-9297cd490cfff2dc)

Found a 'test' script in the Anchor.toml. Running it as a test suite!

Running test suite: "/Users/kartiktomar/rustie/validator_anchor_demo/Anchor.toml"

yarn run v1.22.22
$ /Users/kartiktomar/rustie/validator_anchor_demo/node_modules/.bin/ts-mocha -p ./tsconfig.json -t 1000000 'tests/**/*.ts'


  smartolana
‚úÖ Token mint created at: GJqS5hnzkE47cm6gckaKoTvuC12A2T28JwQuEKsGqNrU
    ‚úî Creates the mint (332ms)
üõ† Creating Profile PDA at: EfG6hS732QuQ44X6KFY3zaoqyiWahNZRE7zAH8Djsyco
‚úÖ Profile Created:
‚Ä¢ Address   : EfG6hS732QuQ44X6KFY3zaoqyiWahNZRE7zAH8Djsyco
‚Ä¢ Authority : 7RETC4uY738hokWxQ8iwCQNiTHAq6Dk1sFzT1HPQrqy4
‚Ä¢ Name      : Kartik
‚Ä¢ Bump      : 252
    ‚úî Initializes a PDA profile for the user (469ms)
üõ† Creating Validator PDA at: DNCKvqKTEj7LjfQFU7K7t4tc3wjuJVcLTSo7ZuGDWaMc
üõ† Using Mint PDA: GJqS5hnzkE47cm6gckaKoTvuC12A2T28JwQuEKsGqNrU
üõ† Mint Auth PDA: EnvPh5jE4q1mN4v4kfSmwUjjpZEbyPaDYpyZndkP2Ms9
üõ† Validator ATA: 9y3LGNwnYXJApjPxPNCtUg9hRabkGWmYi9rJa2Q9D3qp
‚úÖ Validator Created:
‚Ä¢ Pubkey    : DNCKvqKTEj7LjfQFU7K7t4tc3wjuJVcLTSo7ZuGDWaMc
‚Ä¢ ID        : 42
‚Ä¢ Name      : KartikValidator
‚Ä¢ Active?   : true
‚Ä¢ Authority : 7RETC4uY738hokWxQ8iwCQNiTHAq6Dk1sFzT1HPQrqy4
‚Ä¢ Profile   : EfG6hS732QuQ44X6KFY3zaoqyiWahNZRE7zAH8Djsyco
‚Ä¢ Bump      : 255
    ‚úî Initializes a PDA validator and mints tokens to ATA (477ms)
üéØ Created ATA for recipient: GD1L4MtUXXH9VoDSms1g4tnJ1WsqwjkHcwSSRyBFPdhG
üí∞ Sender balance before: 100000000000
üí∞ Recipient balance before: 0
‚úÖ Token transfer complete!
üí∏ Sender balance after: 90000000000
üéâ Recipient balance after: 10000000000
    ‚úî Transfers tokens to another user (2803ms)
üî• Burned tokens!
üí∞ Balance before: 90000000000
üí∏ Balance after : 85000000000
    ‚úî Burns tokens from user's ATA (468ms)
‚úÖ StakingPool Created:
‚Ä¢ ID         : 99
‚Ä¢ Name       : Default Pool
‚Ä¢ Stake Mint : GJqS5hnzkE47cm6gckaKoTvuC12A2T28JwQuEKsGqNrU
‚Ä¢ Reward Mint: GJqS5hnzkE47cm6gckaKoTvuC12A2T28JwQuEKsGqNrU
‚Ä¢ Reward/sec : 1000000
‚Ä¢ Lock Period: 5
    ‚úî üü¢ Initializes a staking pool (455ms)
‚úÖ Staked successfully:
‚Ä¢ Vault Owner      : 7RETC4uY738hokWxQ8iwCQNiTHAq6Dk1sFzT1HPQrqy4
‚Ä¢ Stake Amount     : 5000000000
‚Ä¢ Start Stake Time : 1751087738
    ‚úî Stakes tokens from user ATA to stake vault (469ms)
‚è≥ Waiting to accumulate reward...
‚úÖ Reward claimed: 4000000
    ‚úî Claims rewards after staking duration (3225ms)
‚è± Waiting (simulated)... stake is still locked.
‚úÖ Unstaked tokens from vault:
‚Ä¢ Returned to User: 5000000000
‚Ä¢ Vault now holds : 0
    ‚úî Unstakes tokens after lock period (3282ms)
üîÅ Reassigned Mint Authority to: 5mNZzLRxyCXb7D4vu7bMj7kYZag6L1mekRBproTfLva8
üßæ On-chain Mint Authority     : 5mNZzLRxyCXb7D4vu7bMj7kYZag6L1mekRBproTfLva8
    ‚úî Reassigns the mint authority (2317ms)
‚úÖ Validator updated: { id: 42, name: 'UpdatedValidator', isActive: false }
    ‚úî Updates PDA validator info (466ms)
üìù Proposal PDA: 9J92bUMZanYTEwUUUqQTbcGDYqxzioJ6AzgmZFyuuJGN
‚úÖ Proposal Created:
‚Ä¢ Title       : Decentralize Mint Access
‚Ä¢ Description : Proposal to allow multiple mint signers
‚Ä¢ Created At  : 1751087748
‚Ä¢ Deadline    : 1751091349
    ‚úî Creates a proposal using PDA (462ms)
üó≥ Vote Cast: { vote: true, timestamp: '1751087749' }
    ‚úî Allows a valid vote from validator (931ms)
‚úÖ Rejected duplicate vote: Simulation failed. 
Message: Transaction simulation failed: Error processing Instruction 0: custom program error: 0x0. 
Logs: 
[
  "Program BH2vhWg3AJqKn5VXKf6nepTPQUigJEhPEApUo9XXekjz invoke [1]",
  "Program log: Instruction: VoteOnProposal",
  "Program 11111111111111111111111111111111 invoke [2]",
  "Allocate: account Address { address: 4eUxLHJRgLqytF12x3K5WByhYT83opocFJyKc447B7ic, base: None } already in use",
  "Program 11111111111111111111111111111111 failed: custom program error: 0x0",
  "Program BH2vhWg3AJqKn5VXKf6nepTPQUigJEhPEApUo9XXekjz consumed 9747 of 200000 compute units",
  "Program BH2vhWg3AJqKn5VXKf6nepTPQUigJEhPEApUo9XXekjz failed: custom program error: 0x0"
]. 
Catch the `SendTransactionError` and call `getLogs()` on it for full details.
    ‚úî Rejects duplicate vote from same validator (939ms)
‚úÖ Rejected expired vote: AnchorError thrown in programs/smartolana/src/lib.rs:182. Error Code: ProposalExpired. Error Number: 6002. Error Message: Voting period has ended for this proposal.
    ‚úî Rejects vote on expired proposal (3469ms)
‚úÖ Validator account closed. Lamports refunded: 1707200
    ‚úî Closes PDA validator account (225ms)
    ‚ùå Negative Tests
‚úÖ Lock enforced: AnchorError thrown in programs/smartolana/src/lib.rs:245. Error Code: StakeLocked. Error Number: 6005. Error Message: Stake is still locked. Please wait for the lock period to pass..
      ‚úî ‚ùå Prevents unstaking before lock expires (464ms)
‚úÖ Unauthorized reassignment rejected: unknown signer: 6whVBKjHGrRm8785fjSoVyF8uvFDbWi9QWDLtkDL4bLe
      ‚úî ‚ùå Prevents unauthorized mint authority reassignment
‚úÖ Rejected zero stake: AnchorError caused by account: profile. Error Code: ConstraintRaw. Error Number: 2003. Error Message: A raw constraint was violated.
      1) ‚ùå Prevents staking zero tokens
‚úÖ Rejected unauthorized update: AnchorError caused by account: validator. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.
      2) ‚ùå Prevents unauthorized validator update
‚úÖ Rejected no-signer mint change: Simulation failed. 
Message: Transaction simulation failed: Error processing Instruction 0: custom program error: 0x4. 
Logs: 
[
  "Program BH2vhWg3AJqKn5VXKf6nepTPQUigJEhPEApUo9XXekjz invoke [1]",
  "Program log: Instruction: ReassignMintAuthority",
  "Program TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA invoke [2]",
  "Program log: Instruction: SetAuthority",
  "Program log: Error: owner does not match",
  "Program TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA consumed 2799 of 189668 compute units",
  "Program TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA failed: custom program error: 0x4",
  "Program BH2vhWg3AJqKn5VXKf6nepTPQUigJEhPEApUo9XXekjz consumed 13131 of 200000 compute units",
  "Program BH2vhWg3AJqKn5VXKf6nepTPQUigJEhPEApUo9XXekjz failed: custom program error: 0x4"
]. 
Catch the `SendTransactionError` and call `getLogs()` on it for full details.
      ‚úî ‚ùå Rejects mint authority change without signer


  19 passing (24s)
  2 failing

  1) smartolana
       ‚ùå Negative Tests
         ‚ùå Prevents staking zero tokens:
     AssertionError: expected 'AnchorError caused by account: profil‚Ä¶' to include 'ZeroStake'
      at Context.<anonymous> (tests/smartolana.ts:912:32)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)

  2) smartolana
       ‚ùå Negative Tests
         ‚ùå Prevents unauthorized validator update:
     AssertionError: expected 'AnchorError caused by account: valida‚Ä¶' to include 'has_one constraint violation'
      at Context.<anonymous> (tests/smartolana.ts:939:32)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)



error Command failed with exit code 2.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
